# ğŸµ Monkey Patch Flow Diagram - How It Affects Docling

## ğŸ“Š COMPLETE PROCESS FLOW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          YOUR PYTHON SCRIPT                                  â”‚
â”‚                                                                              â”‚
â”‚   from docling.document_converter import DocumentConverter                  â”‚
â”‚   converter = DocumentConverter()                                           â”‚
â”‚   result = converter.convert("document.pdf")                                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       DOCLING DOCUMENT CONVERTER                             â”‚
â”‚                                                                              â”‚
â”‚  For each page in PDF:                                                      â”‚
â”‚    1. Extract text cells (PyMuPDF)                                          â”‚
â”‚    2. Run AI Layout Model (Granite-258M)  â† AI predicts bboxes & labels    â”‚
â”‚    3. Post-process layout                                                   â”‚
â”‚    4. Extract tables                                                        â”‚
â”‚    5. Build document structure                                              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Step 3: Post-process layout
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      LAYOUT MODEL (layout_model.py)                          â”‚
â”‚                                                                              â”‚
â”‚   processed_clusters, processed_cells = LayoutPostprocessor(                â”‚
â”‚       page, ai_clusters, options                                            â”‚
â”‚   ).postprocess()                    ğŸ‘ˆ THIS IS WHERE WE INJECT!            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LAYOUT POSTPROCESSOR - postprocess()                      â”‚
â”‚                                                                              â”‚
â”‚   def postprocess(self):                                                    â”‚
â”‚       self.regular_clusters = self._process_regular_clusters()  ğŸ‘ˆ PATCHED! â”‚
â”‚       self.special_clusters = self._process_special_clusters()              â”‚
â”‚       return final_clusters, cells                                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                         â”‚
         WITHOUT PATCH                  WITH PATCH
                    â”‚                         â”‚
                    â–¼                         â–¼
```

---

## ğŸ”´ WITHOUT MONKEY PATCH (Vanilla Docling)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            _process_regular_clusters() - ORIGINAL METHOD                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  INPUT:                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ self.regular_clusters = [AI-detected clusters]              â”‚            â”‚
â”‚  â”‚   - TEXT (confidence 0.87)                                  â”‚            â”‚
â”‚  â”‚   - TEXT (confidence 0.91)                                  â”‚            â”‚
â”‚  â”‚   - SECTION_HEADER (confidence 0.52)  â† AI found this       â”‚            â”‚
â”‚  â”‚   - TEXT (confidence 0.88)                                  â”‚            â”‚
â”‚  â”‚   - LIST_ITEM (confidence 0.65)                             â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ self.cells = [All text cells from page]                     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  STEP 1: Filter by confidence                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ clusters = [c for c in self.regular_clusters                â”‚            â”‚
â”‚  â”‚            if c.confidence >= CONFIDENCE_THRESHOLDS[c.label]]â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                  â†“                                                           â”‚
â”‚         Keep only high-confidence clusters                                  â”‚
â”‚                                                                              â”‚
â”‚  STEP 2: Apply label remapping                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ TITLE â†’ SECTION_HEADER                                      â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  STEP 3: Assign cells to clusters                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ For each text cell:                                         â”‚            â”‚
â”‚  â”‚   Find cluster with best bbox overlap                       â”‚            â”‚
â”‚  â”‚   Assign cell to that cluster                               â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  STEP 4: Remove overlapping clusters                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ If two clusters overlap >80%, keep the best one             â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  OUTPUT:                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Processed clusters (AI only):                               â”‚            â”‚
â”‚  â”‚   - TEXT (5 cells)                                          â”‚            â”‚
â”‚  â”‚   - TEXT (8 cells)                                          â”‚            â”‚
â”‚  â”‚   - SECTION_HEADER (3 cells) â† Only 1 title detected        â”‚            â”‚
â”‚  â”‚   - TEXT (12 cells)                                         â”‚            â”‚
â”‚  â”‚   - LIST_ITEM (4 cells)                                     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  TOTAL: ~5 section headers (AI missed many titles!)                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŸ¢ WITH MONKEY PATCH (Our Custom Code)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            _process_regular_clusters() - PATCHED METHOD                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  INPUT (SAME AS BEFORE):                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ self.regular_clusters = [AI-detected clusters]              â”‚            â”‚
â”‚  â”‚ self.cells = [All text cells from page]                     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  â­ NEW STEP A: Run Custom Detector                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ ğŸµ MONKEY PATCH CODE STARTS HERE                            â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ # Convert cells to blocks                                   â”‚            â”‚
â”‚  â”‚ page_blocks = []                                            â”‚            â”‚
â”‚  â”‚ for cell in self.cells:                                     â”‚            â”‚
â”‚  â”‚     page_blocks.append({                                    â”‚            â”‚
â”‚  â”‚         'bbox': cell.rect.to_bounding_box(),                â”‚            â”‚
â”‚  â”‚         'text': cell.text,                                  â”‚            â”‚
â”‚  â”‚         'page': self.page.page_no                           â”‚            â”‚
â”‚  â”‚     })                                                       â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ # Run DetailedHeadingDetector                               â”‚            â”‚
â”‚  â”‚ detector = DetailedHeadingDetector()                        â”‚ MONKEY PATCH (vanilla Docling)
  =================           â”‚
â”‚  â”‚ custom_titles = detector.detect_headings(                   â”‚            â”‚
â”‚  â”‚     page_blocks, self.page.page_no                          â”‚            â”‚
â”‚  â”‚ )                                                            â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ # Found titles with patterns like:                          â”‚            â”‚
â”‚  â”‚ # - "1. DESCRIPCIÃ“N"                                        â”‚            â”‚
â”‚  â”‚ # - "1.1 Resumen"                                           â”‚            â”‚
â”‚  â”‚ # - "a. Detalle"                                            â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                  â†“                                                           â”‚
â”‚         Custom detector found 8 additional titles!                          â”‚
â”‚                                                                              â”‚
â”‚  â­ NEW STEP B: Create Custom Clusters with Cells                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ custom_clusters = []                                        â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ for title in custom_titles:                                 â”‚            â”‚
â”‚  â”‚     # Create bbox                                           â”‚            â”‚
â”‚  â”‚     bbox = BoundingBox(title['bbox'])                       â”‚ MONKEY PATCH (vanilla Docling)
  =================           â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚     # Find overlapping cells                                â”‚            â”‚
â”‚  â”‚     assigned_cells = []                                     â”‚            â”‚
â”‚  â”‚     for cell in self.cells:                                 â”‚            â”‚
â”‚  â”‚         if cell.bbox overlaps bbox > 50%:                   â”‚            â”‚
â”‚  â”‚             assigned_cells.append(cell)                     â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚     # Create cluster with SECTION_HEADER label              â”‚            â”‚
â”‚  â”‚     cluster = Cluster(                                      â”‚            â”‚
â”‚  â”‚         label=DocItemLabel.SECTION_HEADER,  â† Custom!       â”‚            â”‚
â”‚  â”‚         bbox=bbox,                                          â”‚            â”‚
â”‚  â”‚         confidence=0.95,                                    â”‚            â”‚
â”‚  â”‚         cells=assigned_cells  â† Pre-assigned!               â”‚            â”‚
â”‚  â”‚     )                                                        â”‚            â”‚
â”‚  â”‚     custom_clusters.append(cluster)                         â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                  â†“                                                           â”‚
â”‚         Created 8 SECTION_HEADER clusters with cells assigned               â”‚
â”‚                                                                              â”‚
â”‚  â­ NEW STEP C: Merge with AI Clusters                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ # Add custom clusters to self.regular_clusters              â”‚            â”‚
â”‚  â”‚ self.regular_clusters.extend(custom_clusters)               â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ # Now self.regular_clusters contains:                       â”‚            â”‚
â”‚  â”‚ #   - Original AI clusters (5)                              â”‚            â”‚
â”‚  â”‚ #   + Custom clusters (8)                                   â”‚            â”‚
â”‚  â”‚ #   = Total (13)                                            â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ ğŸµ MONKEY PATCH CODE ENDS HERE                              â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                  â†“                                                           â”‚
â”‚         Merged: AI (5) + Custom (8) = 13 clusters                           â”‚
â”‚                                                                              â”‚
â”‚  STEP 1: Call Original Method                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ return _original_process_regular_clusters(self)             â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ # This runs Docling's original logic on merged clusters:    â”‚            â”‚
â”‚  â”‚ # - Filter by confidence âœ“                                  â”‚            â”‚
â”‚  â”‚ # - Apply label remapping âœ“                                 â”‚            â”‚
â”‚  â”‚ # - Assign cells (already done for custom) âœ“                â”‚            â”‚
â”‚  â”‚ # - Remove overlaps âœ“                                       â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  OUTPUT:                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Processed clusters (AI + Custom):                           â”‚            â”‚
â”‚  â”‚   - TEXT (5 cells)                                          â”‚            â”‚
â”‚  â”‚   - SECTION_HEADER (3 cells) â† From AI                      â”‚            â”‚
â”‚  â”‚   - SECTION_HEADER (4 cells) â† Custom detected!             â”‚            â”‚
â”‚  â”‚   - TEXT (8 cells)                                          â”‚            â”‚
â”‚  â”‚   - SECTION_HEADER (2 cells) â† Custom detected!             â”‚            â”‚
â”‚  â”‚   - SECTION_HEADER (5 cells) â† Custom detected!             â”‚            â”‚
â”‚  â”‚   - TEXT (12 cells)                                         â”‚            â”‚
â”‚  â”‚   - SECTION_HEADER (3 cells) â† Custom detected!             â”‚            â”‚
â”‚  â”‚   - LIST_ITEM (4 cells)                                     â”‚            â”‚
â”‚  â”‚   ... (more custom section headers)                         â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  TOTAL: ~18 section headers (AI + Custom detector!)                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ SIDE-BY-SIDE COMPARISON

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         WITHOUT PATCH                 â•‘           WITH PATCH                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                       â•‘                                       â•‘
â•‘  _process_regular_clusters():        â•‘  _process_regular_clusters():         â•‘
â•‘                                       â•‘                                       â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘  â”‚ INPUT:                      â”‚     â•‘  â”‚ INPUT:                      â”‚     â•‘
â•‘  â”‚ â€¢ AI clusters (5)           â”‚     â•‘  â”‚ â€¢ AI clusters (5)           â”‚     â•‘
â•‘  â”‚ â€¢ Text cells (50)           â”‚     â•‘  â”‚ â€¢ Text cells (50)           â”‚     â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘             â†“                         â•‘             â†“                         â•‘
â•‘                                       â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘                                       â•‘  â”‚ ğŸµ MONKEY PATCH INJECTS:    â”‚     â•‘
â•‘                                       â•‘  â”‚                             â”‚     â•‘
â•‘                                       â•‘  â”‚ 1. Run custom detector      â”‚     â•‘
â•‘                                       â•‘  â”‚ 2. Find 8 more titles       â”‚     â•‘
â•‘                                       â•‘  â”‚ 3. Create SECTION_HEADER    â”‚     â•‘
â•‘                                       â•‘  â”‚    clusters with cells      â”‚     â•‘
â•‘                                       â•‘  â”‚ 4. Merge with AI clusters   â”‚     â•‘
â•‘                                       â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘                                       â•‘             â†“                         â•‘
â•‘                                       â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘                                       â•‘  â”‚ MERGED INPUT:               â”‚     â•‘
â•‘                                       â•‘  â”‚ â€¢ AI clusters (5)           â”‚     â•‘
â•‘                                       â•‘  â”‚ â€¢ Custom clusters (8)       â”‚     â•‘
â•‘                                       â•‘  â”‚ â€¢ Total: 13 clusters        â”‚     â•‘
â•‘                                       â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘             â†“                         â•‘             â†“                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘  â”‚ PROCESSING:                 â”‚     â•‘  â”‚ PROCESSING (SAME):          â”‚     â•‘
â•‘  â”‚ â€¢ Filter confidence         â”‚     â•‘  â”‚ â€¢ Filter confidence         â”‚     â•‘
â•‘  â”‚ â€¢ Remap labels              â”‚     â•‘  â”‚ â€¢ Remap labels              â”‚     â•‘
â•‘  â”‚ â€¢ Assign cells              â”‚     â•‘  â”‚ â€¢ Assign cells (already doneâ”‚     â•‘
â•‘  â”‚ â€¢ Remove overlaps           â”‚     â•‘  â”‚   for custom clusters)      â”‚     â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘  â”‚ â€¢ Remove overlaps           â”‚     â•‘
â•‘             â†“                         â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘                                       â•‘             â†“                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘
â•‘  â”‚ OUTPUT:                     â”‚     â•‘  â”‚ OUTPUT:                     â”‚     â•‘
â•‘  â”‚ â€¢ TEXT: 20 items            â”‚     â•‘  â”‚ â€¢ TEXT: 20 items            â”‚     â•‘
â•‘  â”‚ â€¢ SECTION_HEADER: 5 items   â”‚ â—„â”â”â•¬â•â•â”‚ â€¢ SECTION_HEADER: 18 items  â”‚     â•‘
â•‘  â”‚ â€¢ LIST_ITEM: 4 items        â”‚     â•‘  â”‚ â€¢ LIST_ITEM: 4 items        â”‚     â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘
â•‘                                       â•‘                                       â•‘
â•‘  Total section headers: 5             â•‘  Total section headers: 18           â•‘
â•‘  âŒ Missed many numbered titles       â•‘  âœ… Found AI + custom titles         â•‘
â•‘                                       â•‘                                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                                   â–²
                                                   â”‚
                                   Difference = +13 section headers!
                                   These are the custom-detected titles
```

---

## ğŸ¯ KEY INSIGHT: Where The Monkey Lives

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           PYTHON MEMORY                                      â”‚
â”‚                                                                              â”‚
â”‚  LayoutPostprocessor Class Object:                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚  __dict__ = {                                                â”‚            â”‚
â”‚  â”‚      'postprocess': <function at 0x7f8a1234>,                â”‚            â”‚
â”‚  â”‚      '_process_regular_clusters': <function at 0x7f8a5678>,  â”‚  â—„â”€â”      â”‚
â”‚  â”‚      '_process_special_clusters': <function at 0x7f8a9abc>,  â”‚    â”‚      â”‚
â”‚  â”‚      ... other methods ...                                   â”‚    â”‚      â”‚
â”‚  â”‚  }                                                            â”‚    â”‚      â”‚
â”‚  â”‚                                                              â”‚    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚      â”‚
â”‚                                                                      â”‚      â”‚
â”‚                                                                      â”‚      â”‚
â”‚  ğŸµ MONKEY CHANGES THIS REFERENCE:                                  â”‚      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                               â”‚      â”‚
â”‚                                                                      â”‚      â”‚
â”‚  # Before patch:                                                    â”‚      â”‚
â”‚  LayoutPostprocessor._process_regular_clusters                      â”‚      â”‚
â”‚      points to â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚      <Docling's original method at 0x7f8a5678>                              â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  # After patch:                                                             â”‚
â”‚  LayoutPostprocessor._process_regular_clusters                              â”‚
â”‚      points to â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚      <YOUR custom method at 0x7f8b1111>              â”‚                      â”‚
â”‚                                                       â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ YOUR CUSTOM METHOD (in memory):                             â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ def _patched_process_regular_clusters(self):                â”‚            â”‚
â”‚  â”‚     # Run custom detector                                   â”‚            â”‚
â”‚  â”‚     custom_clusters = ...                                   â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚     # Merge with AI                                         â”‚            â”‚
â”‚  â”‚     self.regular_clusters.extend(custom_clusters)           â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚     # Call original (stored separately)                     â”‚            â”‚
â”‚  â”‚     return _original_method(self)  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚            â”‚
â”‚  â”‚                                               â”‚              â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                  â”‚                           â”‚
â”‚                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  _original_method = <Docling's method at 0x7f8a5678>       â”‚                â”‚
â”‚  (saved before patching)                                   â”‚                â”‚
â”‚                                                             â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ DOCLING'S ORIGINAL METHOD (still in memory):               â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â”‚ def _process_regular_clusters(self):                        â”‚            â”‚
â”‚  â”‚     # Filter confidence                                     â”‚            â”‚
â”‚  â”‚     # Remap labels                                          â”‚            â”‚
â”‚  â”‚     # Assign cells                                          â”‚            â”‚
â”‚  â”‚     # Remove overlaps                                       â”‚            â”‚
â”‚  â”‚     return processed_clusters                               â”‚            â”‚
â”‚  â”‚                                                              â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

When Docling calls:
    processor._process_regular_clusters()

Python looks up the method in LayoutPostprocessor.__dict__ and finds YOUR method!
Docling has NO IDEA it's running your code! ğŸµ
```

---

## ğŸ“ˆ VISUAL: Data Flow Through Pipeline

```
                    PDF DOCUMENT
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Docling: Extract Text Cells   â”‚
        â”‚  (PyMuPDF)                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ cells = [{text, bbox}, {text, bbox}, ...]
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Docling: Run AI Layout Model  â”‚
        â”‚  (Granite-258M)                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ ai_clusters = [
                     â”‚   {label: TEXT, bbox, confidence},
                     â”‚   {label: SECTION_HEADER, bbox, confidence},
                     â”‚   ...
                     â”‚ ]
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  LayoutPostprocessor.postprocess()                     â”‚
        â”‚                                                         â”‚
        â”‚  Calls: self._process_regular_clusters()               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚
    NO PATCH                  WITH PATCH
        â”‚                         â”‚
        â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI clusters only  â”‚    â”‚ ğŸµ MONKEY PATCH INTERCEPTS:   â”‚
â”‚ (5 clusters)      â”‚    â”‚                               â”‚
â”‚                   â”‚    â”‚ 1. Get cells                  â”‚
â”‚ â†“                 â”‚    â”‚ 2. Run DetailedHeadingDetectorâ”‚
â”‚ Filter/Process    â”‚    â”‚ 3. Find 8 custom titles       â”‚
â”‚ â†“                 â”‚    â”‚ 4. Create 8 SECTION_HEADER    â”‚
â”‚ Return 5          â”‚    â”‚    clusters with cells        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ 5. Merge: ai_clusters +       â”‚
        â”‚                â”‚    custom_clusters = 13       â”‚
        â”‚                â”‚                               â”‚
        â”‚                â”‚ â†“                             â”‚
        â”‚                â”‚ Call original method          â”‚
        â”‚                â”‚ â†“                             â”‚
        â”‚                â”‚ Filter/Process 13 clusters    â”‚
        â”‚                â”‚ â†“                             â”‚
        â”‚                â”‚ Return 13                     â”‚
        â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Return to Docling             â”‚
        â”‚                                 â”‚
        â”‚  clusters = [processed results] â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Docling: Build Document       â”‚
        â”‚  Structure                     â”‚
        â”‚                                 â”‚
        â”‚  âŒ NO PATCH HERE!              â”‚
        â”‚  Just uses the clusters from    â”‚
        â”‚  previous step (which were      â”‚
        â”‚  already modified by patch)     â”‚
        â”‚                                 â”‚
        â”‚  for item in clusters:          â”‚
        â”‚      doc.add_element(item)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
                FINAL DOCUMENT
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚
    NO PATCH                  WITH PATCH
    (result)                  (result)
        â”‚                         â”‚
        â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5 section headers â”‚    â”‚ 18 section headers   â”‚
â”‚ 20 text blocks    â”‚    â”‚ 20 text blocks       â”‚
â”‚ 4 list items      â”‚    â”‚ 4 list items         â”‚
â”‚                   â”‚    â”‚                      â”‚
â”‚ Total: 29 items   â”‚    â”‚ Total: 42 items      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â–²
                                   â”‚
                    These are RESULTS of the ONE patch
                    that happened earlier (in step 3)!
                    NOT a second patch location!
```

---

## ğŸ” ZOOM IN: What Happens Inside Patched Method

```
def _patched_process_regular_clusters(self):

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 1: Access Docling's Data                               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                              â”‚
    â”‚  self.cells = [                                              â”‚
    â”‚      TextCell(text="INFORME", bbox=(50, 100, 200, 120)),    â”‚
    â”‚      TextCell(text="DE", bbox=(210, 100, 240, 120)),        â”‚
    â”‚      TextCell(text="ANÃLISIS", bbox=(250, 100, 350, 120)),  â”‚
    â”‚      TextCell(text="1.", bbox=(50, 150, 70, 170)),          â”‚
    â”‚      TextCell(text="DESCRIPCIÃ“N", bbox=(80, 150, 200, 170)),â”‚
    â”‚      ... (50 more cells)                                     â”‚
    â”‚  ]                                                           â”‚
    â”‚                                                              â”‚
    â”‚  self.regular_clusters = [                                   â”‚
    â”‚      Cluster(id=1, label=TEXT, confidence=0.87),            â”‚
    â”‚      Cluster(id=2, label=TEXT, confidence=0.91),            â”‚
    â”‚      Cluster(id=3, label=SECTION_HEADER, confidence=0.52),  â”‚
    â”‚      ... (5 clusters from AI)                                â”‚
    â”‚  ]                                                           â”‚
    â”‚                                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 2: Convert to Format for Custom Detector               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                              â”‚
    â”‚  page_blocks = []                                            â”‚
    â”‚  for cell in self.cells:                                     â”‚
    â”‚      bbox_obj = cell.rect.to_bounding_box()                  â”‚
    â”‚      page_blocks.append({                                    â”‚
    â”‚          'bbox': {                                           â”‚
    â”‚              'x0': bbox_obj.l,                               â”‚
    â”‚              'y0': bbox_obj.t,                               â”‚
    â”‚              'x1': bbox_obj.r,                               â”‚
    â”‚              'y1': bbox_obj.b                                â”‚
    â”‚          },                                                  â”‚
    â”‚          'text': cell.text,                                  â”‚
    â”‚          'page': self.page.page_no                           â”‚
    â”‚      })                                                       â”‚
    â”‚                                                              â”‚
    â”‚  # Now page_blocks = [                                       â”‚
    â”‚  #   {'text': 'INFORME', 'bbox': {...}, 'page': 1},         â”‚
    â”‚  #   {'text': 'DE', 'bbox': {...}, 'page': 1},              â”‚
    â”‚  #   {'text': '1.', 'bbox': {...}, 'page': 1},              â”‚
    â”‚  #   ...                                                     â”‚
    â”‚  # ]                                                         â”‚
    â”‚                                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 3: Run Custom Detector                                 â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                              â”‚
    â”‚  detector = DetailedHeadingDetector()                        â”‚
    â”‚  custom_titles = detector.detect_headings(                   â”‚
    â”‚      page_blocks, self.page.page_no                          â”‚
    â”‚  )                                                           â”‚
    â”‚                                                              â”‚
    â”‚  # Detector finds patterns:                                  â”‚
    â”‚  # - "1. DESCRIPCIÃ“N" (pattern: number + period)            â”‚
    â”‚  # - "1.1 Resumen" (pattern: nested number)                 â”‚
    â”‚  # - "a. Detalle" (pattern: letter + period)                â”‚
    â”‚  #                                                           â”‚
    â”‚  # custom_titles = [                                         â”‚
    â”‚  #   {                                                       â”‚
    â”‚  #     'text': '1. DESCRIPCIÃ“N DE LA PERTURBACIÃ“N',         â”‚
    â”‚  #     'bbox': {'x0': 50, 'y0': 150, 'x1': 400, 'y1': 170}, â”‚
    â”‚  #     'level': 1,                                           â”‚
    â”‚  #     'page': 1                                             â”‚
    â”‚  #   },                                                      â”‚
    â”‚  #   {                                                       â”‚
    â”‚  #     'text': '1.1 Resumen de la perturbaciÃ³n',            â”‚
    â”‚  #     'bbox': {'x0': 50, 'y0': 200, 'x1': 380, 'y1': 220}, â”‚
    â”‚  #     'level': 2,                                           â”‚
    â”‚  #     'page': 1                                             â”‚
    â”‚  #   },                                                      â”‚
    â”‚  #   ... (8 titles total)                                    â”‚
    â”‚  # ]                                                         â”‚
    â”‚                                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 4: Create Clusters from Custom Titles                  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                              â”‚
    â”‚  custom_clusters = []                                        â”‚
    â”‚  next_id = max(c.id for c in self.regular_clusters) + 1     â”‚
    â”‚                                                              â”‚
    â”‚  for i, title in enumerate(custom_titles):                   â”‚
    â”‚      # Create BoundingBox                                    â”‚
    â”‚      bbox = BoundingBox(                                     â”‚
    â”‚          l=title['bbox']['x0'],                              â”‚
    â”‚          t=title['bbox']['y0'],                              â”‚
    â”‚          r=title['bbox']['x1'],                              â”‚
    â”‚          b=title['bbox']['y1'],                              â”‚
    â”‚          coord_origin=self.page.size.coord_origin            â”‚
    â”‚      )                                                       â”‚
    â”‚                                                              â”‚
    â”‚      # Find cells that overlap with this title               â”‚
    â”‚      assigned_cells = []                                     â”‚
    â”‚      for cell in self.cells:                                 â”‚
    â”‚          cell_bbox = cell.rect.to_bounding_box()             â”‚
    â”‚          overlap = cell_bbox.intersection_over_self(bbox)    â”‚
    â”‚          if overlap > 0.5:  # 50% overlap threshold          â”‚
    â”‚              assigned_cells.append(cell)                     â”‚
    â”‚                                                              â”‚
    â”‚      # Create cluster                                        â”‚
    â”‚      cluster = Cluster(                                      â”‚
    â”‚          id=next_id + i,                                     â”‚
    â”‚          label=DocItemLabel.SECTION_HEADER,  â† KEY!          â”‚
    â”‚          bbox=bbox,                                          â”‚
    â”‚          confidence=0.95,                                    â”‚
    â”‚          cells=assigned_cells  â† Cells already assigned!     â”‚
    â”‚      )                                                       â”‚
    â”‚      custom_clusters.append(cluster)                         â”‚
    â”‚                                                              â”‚
    â”‚  # custom_clusters = [                                       â”‚
    â”‚  #   Cluster(id=6, label=SECTION_HEADER, cells=[...]),      â”‚
    â”‚  #   Cluster(id=7, label=SECTION_HEADER, cells=[...]),      â”‚
    â”‚  #   ... (8 clusters)                                        â”‚
    â”‚  # ]                                                         â”‚
    â”‚                                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 5: Merge with AI Clusters                              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                              â”‚
    â”‚  # BEFORE merge:                                             â”‚
    â”‚  # self.regular_clusters = [5 AI clusters]                   â”‚
    â”‚  #                                                           â”‚
    â”‚  # AFTER merge:                                              â”‚
    â”‚  self.regular_clusters.extend(custom_clusters)               â”‚
    â”‚  # self.regular_clusters = [                                 â”‚
    â”‚  #   ... 5 AI clusters ...                                   â”‚
    â”‚  #   ... 8 custom clusters ...                               â”‚
    â”‚  # ]                                                         â”‚
    â”‚  # Total: 13 clusters                                        â”‚
    â”‚                                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ STEP 6: Call Original Docling Method                        â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                              â”‚
    â”‚  return _original_process_regular_clusters(self)             â”‚
    â”‚                                                              â”‚
    â”‚  # This runs Docling's logic on ALL 13 clusters:             â”‚
    â”‚  # - Filter by confidence                                    â”‚
    â”‚  # - Remap labels                                            â”‚
    â”‚  # - Assign cells (already done for custom)                  â”‚
    â”‚  # - Remove overlapping clusters                             â”‚
    â”‚  # - Adjust bboxes                                           â”‚
    â”‚  #                                                           â”‚
    â”‚  # Returns: processed_clusters (13 items)                    â”‚
    â”‚                                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ FINAL RESULT COMPARISON

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    EXTRACTION RESULTS COMPARISON                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                             â•‘
â•‘  WITHOUT PATCH:                        WITH PATCH:                         â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â•‘
â•‘                                                                             â•‘
â•‘  result.document.iterate_items():      result.document.iterate_items():    â•‘
â•‘                                                                             â•‘
â•‘  1. TEXT                               1. TEXT                             â•‘
â•‘     "Este informe presenta..."            "Este informe presenta..."       â•‘
â•‘                                                                             â•‘
â•‘  2. TEXT                               2. SECTION_HEADER â† Custom!         â•‘
â•‘     "INFORME DE ANÃLISIS"                 "INFORME DE ANÃLISIS"            â•‘
â•‘                                                                             â•‘
â•‘  3. TEXT                               3. SECTION_HEADER â† Custom!         â•‘
â•‘     "1. DESCRIPCIÃ“N"                      "1. DESCRIPCIÃ“N"                 â•‘
â•‘                                                                             â•‘
â•‘  4. TEXT                               4. TEXT                             â•‘
â•‘     "La perturbaciÃ³n ocurriÃ³..."          "La perturbaciÃ³n ocurriÃ³..."     â•‘
â•‘                                                                             â•‘
â•‘  5. SECTION_HEADER (AI found)          5. SECTION_HEADER â† AI found        â•‘
â•‘     "Resumen ejecutivo"                   "Resumen ejecutivo"              â•‘
â•‘                                                                             â•‘
â•‘  6. TEXT                               6. SECTION_HEADER â† Custom!         â•‘
â•‘     "1.1 Resumen de la perturbaciÃ³n"      "1.1 Resumen de la perturbaciÃ³n" â•‘
â•‘                                                                             â•‘
â•‘  ... 24 more items ...                 ... 37 more items ...               â•‘
â•‘                                                                             â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•‘
â•‘                                                                             â•‘
â•‘  STATISTICS:                           STATISTICS:                         â•‘
â•‘  â€¢ Total items: 29                     â€¢ Total items: 42                   â•‘
â•‘  â€¢ Section headers: 5                  â€¢ Section headers: 18               â•‘
â•‘  â€¢ Text blocks: 20                     â€¢ Text blocks: 20                   â•‘
â•‘  â€¢ List items: 4                       â€¢ List items: 4                     â•‘
â•‘                                                                             â•‘
â•‘  âŒ Many titles classified as TEXT     âœ… Titles correctly classified      â•‘
â•‘  âŒ Hierarchical structure lost        âœ… Hierarchical structure preserved â•‘
â•‘                                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                      â–²
                                      â”‚
                         All because of monkey patch! ğŸµ
```

---

## ğŸ“š Summary

**Monkey Patch Flow:**
1. ğŸµ Swap `_process_regular_clusters` method reference in memory
2. ğŸ“„ Docling converts PDF â†’ extracts cells â†’ runs AI model
3. ğŸ”§ Docling calls `LayoutPostprocessor._process_regular_clusters()`
4. ğŸ¯ **YOUR method runs** instead of Docling's
5. ğŸ” Your method runs `DetailedHeadingDetector` on cells
6. âœ… Creates SECTION_HEADER clusters with cells assigned
7. ğŸ”„ Merges custom clusters with AI clusters
8. ğŸ“ Calls original Docling method with merged clusters
9. ğŸ¨ Docling processes ALL clusters (AI + custom)
10. ğŸ“Š Final document has MORE section headers!

**Impact:**
- Section headers: 5 â†’ 18 (+260% improvement!)
- Hierarchical structure preserved
- No modifications to Docling's source code
- Updates don't break your code

**ğŸµ The monkey successfully tampered with the machinery!**
